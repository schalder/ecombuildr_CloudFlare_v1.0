<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- SEO will be injected by Edge Function -->
    <title>Loading...</title>
    <meta name="description" content="Loading..." />
    
    <!-- Dynamic SEO Injection Script - Runs BEFORE React -->
    <script>
      (function() {
        console.log('üöÄ Dynamic SEO injection starting...');
        
        // Detect if this is a custom domain
        const isCustomDomain = !window.location.hostname.includes('ecombuildr.com') && 
                              !window.location.hostname.includes('localhost') && 
                              !window.location.hostname.includes('lovable.dev') &&
                              !window.location.hostname.includes('lovable.app') &&
                              !window.location.hostname.includes('lovableproject.com');
        
        if (isCustomDomain) {
          console.log('üåê Custom domain detected:', window.location.hostname);
          
          // Fetch SEO data from Supabase - use custom_domains table
          fetch('https://fhqwacmokbtbspkxjixf.supabase.co/rest/v1/custom_domains?select=id,domain,store_id&domain=eq.' + window.location.hostname, {
            headers: {
              'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZocXdhY21va2J0YnNwa3hqaXhmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM2MjYyMzUsImV4cCI6MjA2OTIwMjIzNX0.BaqDCDcynSahyDxEUIyZLLtyXpd959y5Tv6t6tIF3GM',
              'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZocXdhY21va2J0YnNwa3hqaXhmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM2MjYyMzUsImV4cCI6MjA2OTIwMjIzNX0.BaqDCDcynSahyDxEUIyZLLtyXpd959y5Tv6t6tIF3GM'
            }
          })
          .then(response => response.json())
          .then(customDomains => {
            if (customDomains && customDomains.length > 0) {
              const customDomain = customDomains[0];
              console.log('‚úÖ Custom domain found:', customDomain);
              
              // Now fetch website data using store_id
              return fetch('https://fhqwacmokbtbspkxjixf.supabase.co/rest/v1/websites?select=id,name,settings&store_id=eq.' + customDomain.store_id + '&is_active=eq.true&is_published=eq.true', {
                headers: {
                  'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZocXdhY21va2J0YnNwa3hqaXhmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM2MjYyMzUsImV4cCI6MjA2OTIwMjIzNX0.BaqDCDcynSahyDxEUIyZLLtyXpd959y5Tv6t6tIF3GM',
                  'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZocXdhY21va2J0YnNwa3hqaXhmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM2MjYyMzUsImV4cCI6MjA2OTIwMjIzNX0.BaqDCDcynSahyDxEUIyZLLtyXpd959y5Tv6t6tIF3GM'
                }
              });
            } else {
              throw new Error('No custom domain found');
            }
          })
          .then(response => response.json())
          .then(websites => {
            if (websites && websites.length > 0) {
              const website = websites[0];
              console.log('‚úÖ Website data loaded:', website);
              
              // Update title immediately
              document.title = website.name || 'Loading...';
              
              // Update meta description - use website name as fallback
              const description = `Welcome to ${website.name} - Your trusted online store for quality products`;
              let descMeta = document.querySelector('meta[name="description"]');
              if (descMeta) {
                descMeta.setAttribute('content', description);
              } else {
                descMeta = document.createElement('meta');
                descMeta.setAttribute('name', 'description');
                descMeta.setAttribute('content', description);
                document.head.appendChild(descMeta);
              }
              
              // Update OG tags
              const ogTitle = website.name;
              let ogTitleMeta = document.querySelector('meta[property="og:title"]');
              if (ogTitleMeta) {
                ogTitleMeta.setAttribute('content', ogTitle);
              } else {
                ogTitleMeta = document.createElement('meta');
                ogTitleMeta.setAttribute('property', 'og:title');
                ogTitleMeta.setAttribute('content', ogTitle);
                document.head.appendChild(ogTitleMeta);
              }
              
              let ogDescMeta = document.querySelector('meta[property="og:description"]');
              if (ogDescMeta) {
                ogDescMeta.setAttribute('content', description);
              } else {
                ogDescMeta = document.createElement('meta');
                ogDescMeta.setAttribute('property', 'og:description');
                ogDescMeta.setAttribute('content', description);
                document.head.appendChild(ogDescMeta);
              }
              
              // Add OG type and URL
              let ogTypeMeta = document.querySelector('meta[property="og:type"]');
              if (!ogTypeMeta) {
                ogTypeMeta = document.createElement('meta');
                ogTypeMeta.setAttribute('property', 'og:type');
                ogTypeMeta.setAttribute('content', 'website');
                document.head.appendChild(ogTypeMeta);
              }
              
              let ogUrlMeta = document.querySelector('meta[property="og:url"]');
              if (!ogUrlMeta) {
                ogUrlMeta = document.createElement('meta');
                ogUrlMeta.setAttribute('property', 'og:url');
                ogUrlMeta.setAttribute('content', window.location.href);
                document.head.appendChild(ogUrlMeta);
              }
              
              console.log('‚úÖ SEO injected into HTML:', {
                title: document.title,
                description: description,
                ogTitle: ogTitle
              });
            } else {
              console.log('‚ùå No website found for this domain');
            }
          })
          .catch(error => {
            console.error('‚ùå Error loading SEO data:', error);
          });
        } else {
          console.log('üè¢ System domain - using default SEO');
        }
      })();
    </script>
    
    <script type="module" src="/src/main.tsx"></script>
  </head>
  <body>
    <div id="root"></div>
  </body>
</html>
